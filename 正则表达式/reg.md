# 正则表达式

## 有用的资料

书籍

- 《Matering Regular Expression》 Jeffery E.F. Friedl
- 《Introducing Regular Expression》 Jan Goyvaerts
- 《Regular Expression Cookbook》 Levihan

工具站点

- [regex101](https://regex101.com/)
- [regexplanet](http://www.regexplanet.com/advanced/javascript/index.html)

## 优化建议

1. 使用缓存
2. 尽量正确表达意图
3. 避免重复匹配
4. 独立出文本和锚点
5. 不过分依赖正则表达式
   1. 彻底放弃字符串操作
      正则匹配需要先构建有穷自动机，这种操作成本是很高的，如果只需匹配特定的字符串，使用字符串函数效率可能要高一些。
   2. 思维定式
      试图编写复杂而全的表达式，而忘记条件语句的使用
   3. 滥用正则表达式

一个正则表达式包含模式和可选修饰符：g、i、m、s、u、y。
str.search(regexp) 方法返回的是找到的匹配项的索引位置，如果没找到则返回 -1。

正则表达式 模式匹配文本字符串的表达式

## 正则表达式概念

使用`模式`来`匹配字符串`的表达式

## 创建方式

1. 字面量形式

```js
/pattern/flags;
```

2. 构造函数

```js
RegExp(pattern, modifier);
```

一般优先采用字面量形式创建，需要在运行时`动态构造`模式时才使用构造函数形式构建。

## 正则相关的方法

- String对象
  - search();
  - replace();
  - replaceAll();
  - match();
  - split();

- RegExp
  - exec();
  - test();
  - compile();

## 修饰符(6 个)

- i 忽略大小写,默认区分大小写
- g 查找所有匹配项
- m 多行模式
- y 开启粘连匹配 试图从最后一个匹配位置开始
- u 开启对 unicode 字符支持
- s 允许`.`匹配换行符`\n`

## 精确匹配

除了特殊字符和操作符外，字符必须准确出现在表达式中。使用正在表达精确匹配一个字符串(甚至忽略大小写)是没有意义的（使用用字符串比较代替）。
在正则表达式中, 空格是一个字符,与其他字符同等重要。

## 模式相关概念

- 匹配字符集 [] [^a-z]
  - ^在字符集开始表示排除指定字符集之外的任意字符
  - -在字符集中可以用来限定一个连续范围内的字符
  - 整个字符集仅表示匹配一个字符
- 分组 `()` 圆括号具有分组和创建捕获双重功能
- 预定义字符集和元字符
- 转义 `\`使具有特殊功能的字符表示字符本身 如: \$ 、\\
- 起止符
  - 开始`^`
  - 结束`$`
  - 字符串开始`()`
- 量词
  - `？` 可选 出现0次或1次
  - `+` 必须出现1次以上
  - `*` 出现0次以上
  - `{n[, m]}` 至少出现n次，至多出现m次
- 默认贪婪模式, 非贪婪模式 在重复量词后加`?`,只进行最小限度的匹配。
- 或操作符 `|`
- 反向引用 \num 或 $num 捕获分组 引用正则中定义的捕获分组匹配的内容

## 预定义字符集

| 元字符        | 含义                                                                 |
| :------------ | :------------------------------------------------------------------- |
| .             | 匹配除换行字符(\n、\r、\u2028、\u2029)之外的任意字符                      |
| \t            | 水平制表符                                                           |
| \v            | 垂直制表符                                                           |
| \b            | 空格                                                                 |
| \r            | 回车符                                                               |
| \n            | 换行符                                                               |
| \f            | 换页符                                                               |
| [\b]          | 回退符                                                               |
| \d            | 数字 [0-9]                                                           |
| \D            | 非数字 [^0-9]                                                        |
| \w            | “单字”字符：拉丁字母或数字或下划线*。非拉丁字母不属于\w [A-Za-z0-9*]         |
| \W            | [^a-za-z0-9_]                                                        |
| \s            | 空白字符,包括空格、制表符、换行符、换页符等 => [\f\n\r\t\v]                 |
| \S            | 匹配空白字符之外的字符                                                  |
| \b            | 匹配单词边界                                                          |
| \B            | 匹配非单词边界(单词内部)                                                |
| \x00:\xff     | 十六进制ASCII字符                                                    |
| \u0000:\xffff | 十六进制Unicode字符                                                  |
| \0xx          | 八进制值                                                             |
| \cA:\cZ       | 控制字符 Ctrl -A                                                     |

用来匹配退格字符的`[\b]`元字符不在\s 的覆盖范围内，\S 也没有将其排除。

反向类 表示它与所有其他字符匹配。

处理正则表达式一般要经历多个阶段，其中两个主要阶段是编译和执行。在编译阶段,表达式经过 JS 引擎解析转换为内部代码，并缓存表达编译结果,这个过程发生在表达式的创建时期。在执行阶段，使用表达式编译结果进行字符串匹配。

捕获引用主要有两种方式：

- 自身匹配
- 替换字符串

非捕获分组 (?:) 去掉多余的捕获 被动子表达式

String.replace()
第二参数为函数时说明：

- 全文匹配
- 捕获分组
- 匹配索引
- 源字符串
- 函数返回的值作为替换值

匹配所有字符

- [\S\s]\*
- (?:.|\s)\*

正则表达式的主要功能是搜索和替换。
绝大多数正则表达式引擎默认只返回第一个匹配结果,并且默认区分大小写。

`.`字符匹配`除换行符`之外的任意`一个`字符、数字甚至`.`字符本身。带`s`修饰的模式匹配严格任何字符。
匹配任意字符的替代模式

- [^] 匹配任何字符，除了什么都没有
- 互补的类如[\s\S]

元字符 在正则表达式里有特殊意义的字符
\ 转义字符 表示对其后的元字符进行转义。

匹配单个字符

字符集合能匹配特定的字符串和字符区间。其含义是必须匹配该集合的字符之一。
[] 字符集合
`-` 字符区间 尾字符要大于首字符
在同一字符集合里可以给出多个字符区间
`[a-zA-Z0-9]`
指定一组不需要匹配的字符，也即是排除字符集合里指定的那些字符。
`[ns]a[^0-9]\.xls`
^作用于给定字符集合里的所有字符或字符区间，而不仅限于紧跟在^字符后的那一个字符或字符区间

位置匹配

- ^ 只有位于行首才行
- $

常见元字符

- `.`
- `\` 对其他元字符进行转义
- `[`
- `]`
- `-` 只有出现在[和]之间表示字符区间才是元字符，其他情况是普通字符。
  有些字符只在转义字符后才是元字符。

一类用来匹配文本，一类是正则表达式语法的组成部分。

## 字符转义

- 要在字面意义上搜索特殊字符 `[ ] { } \ ^ $ . | ? \* + ( )`，需要在它们前面加上一个反斜杠`\`进行转义。
- 如果在 /.../ 内（但不在 new RegExp 内），需要转义 /。
- 当将字符串传递给给 new RegExp 时，需要双反斜杠 \\，因为字符串引号会消耗一个反斜杠。

## 正则表达式处理

正则表达式一般会经历编译和执行两个阶段，在正则表达式创建时期js引擎会解析转换正则表达式，并缓存表达式的编译结果。

全局匹配与局部匹配

match(pattern) 局部匹配返回包含分组内容，全局匹配不包含分组内容，而是重复应用模式匹配的全部内容列表。在全局匹配中如果需要分组内容需要调用exec()方法。
